<!-- #border-right: 1px solid-->
<!--HTML BOILERPLATE TEMPLATE-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="stylesheet" href="../static/css/style.css">
    <title>Homepage</title>
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" />

    <!--font awesome-->
    <script src="https://kit.fontawesome.com/8adb5da3fe.js" crossorigin="anonymous"></script>

    <!--jquery-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js">
    </script>
</head>

<body>

    <section id="top">
        <!--this section will need to be manipulated by javascript to be opened only at certain times-->
        <div class="header" style="background-color: red; margin-top: -10px; height: auto; padding-bottom: 0px; font-size: 20px;">
            <header>
                <!--a href = "https://news.microsoft.com/covid-19-response/"-->
                <p style="text-align: center; font-weight: bold;"> <a href="https://news.microsoft.com/covid-19-response/" style=" text-decoration: none; color: #fff">Learn more about remote working, online schooling and community support during the COVID-19 outbreak</a></p>
            </header>
        </div>
        <div class="header" style="margin-top: -10px;">
            <header>
                <ul>
                    <li><a href="http://127.0.0.1:5000/settings.html"><i class="fas fa-edit"></i>Edit Your Profile</a></li>
                    <li>
                        <a href="http://127.0.0.1:5000/logout"><i class="fas fa-door-closed"></i>Log Out</a></li>
                    <li class="child_3"><a href="http://127.0.0.1:5000/edit_password.html">Change Password</a></li>
                    <li><a href="http://127.0.0.1:5000/profile/{{session['user']}}"><i class="fas fa-user "></i>My Account</a></li>
                </ul>
            </header>
        </div>

        <div class="title">
            <h1><i class="fas fa-book-open"></i>SP News</h1>
            <hr size="1">
        </div>

        <div class="navbar_side">
            <div class="navbar_side_content">
                <img src="https://previews.123rf.com/images/urfandadashov/urfandadashov1809/urfandadashov180902667/109317646-profile-pic-vector-icon-isolated-on-transparent-background-profile-pic-logo-concept.jpg">
                <ul>
                    <li>
                        Name: {{session['user']}}
                    </li>
                    <li>
                        # of Followers:
                    </li>
                    <li>
                        Keywords: {{user.keywords}}
                    </li>
                </ul>
            </div>
        </div>


        <div class="nav">
            <nav style="padding-bottom: 13px;">
                <ul>
                    {% if user.business == 1 %}
                    <!--if user.business is present, we will add it to ur navbar-->
                    <li class="business"><a href="#">Business</a></li>
                    {% endif %} {% if user.entertainment == 1 %}
                    <li class="entertainment"><a href="#">Entertainment</a></li>
                    {% endif %} {% if user.general == 1 %}
                    <li><a class="general">General</a></li>
                    {% endif %} {% if user.health == 1 %}
                    <li class="health"><a href="#">Health</a></li>
                    {% endif %} {% if user.science == 1 %}
                    <li><a class="science">Science</a></li>
                    {% endif %} {% if user.sports == 1 %}
                    <li class="sports"><a href="#">Sports</a></li>
                    {% endif %} {% if user.technology == 1 %}
                    <li><a class="technology">Technology</a></li>
                    {% endif %} {% if user.keywords != null %}
                    <li><a class="keywords">Keywords</a></li>
                    {% endif %} </ul>

            </nav>

            <hr size="1" style="margin-bottom: .75%;">

            <script>
                function switchNewsFeed(data, category) {
                    if ($('.newsfeed_table')) {
                        $('.newsfeed_table tr').remove();
                        console.log("children removed")
                    }


                    // style=height: 300px; width: 550px; margin-top: 2%; margin-bottom: -3%; filter: drop-shadow(5px 3.5px 2.5px #4f6999);

                    // Filter out the arrays with no elements
                    var newsfeed_data = data.results.filter(e => e.length);

                    for (var preference = 0; preference < newsfeed_data.length; preference++) {
                        for (var article = 0; article < newsfeed_data[preference].length; article++) {
                            if (newsfeed_data[preference][article].category == category) {
                                $(".newsfeed_table").append("<tr><td><img src = " + newsfeed_data[preference][article]['imageurl'] + " class = 'images_front' > </td></tr>" +
                                    "<tr class = 'title_row'>" + "<td><u><a href =" + newsfeed_data[preference][article]['url'] + ">" +
                                    newsfeed_data[preference][article]['title'] + "</a></u></tr>" + "<tr>" + "<td>" + newsfeed_data[preference][article]['category'] + "</tr>" +
                                    "<tr>" + "</td>" + "<td>" + newsfeed_data[preference][article]['dateandtime'] + "</td>" + "</tr>" + "<tr class = 'last_row'>" +
                                    "<td> From: " + newsfeed_data[preference][article]['author'] + "</td>" + "</tr>");
                            }
                        }
                    }
                }


                $(".business").click(function() {
                    console.log("business button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {

                        switchNewsFeed(data, "business")

                    });

                });

                $(".sports").click(function() {
                    console.log("sports button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {
                        console.log("api feed found...")

                        console.log(data.results)

                        switchNewsFeed(data, "sports")

                    });
                });


                $(".entertainment").click(function() {
                    console.log("entertainment button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {
                        console.log("api feed found...")

                        console.log(data.results)

                        switchNewsFeed(data, "entertainment")

                    });

                });


                $(".general").click(function() {
                    console.log("general button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {
                        console.log("api feed found...")

                        console.log(data.results)

                        switchNewsFeed(data, "general")

                    });

                });


                $(".health").click(function() {
                    console.log("health button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {
                        console.log("api feed found...")

                        console.log(data.results)

                        switchNewsFeed(data, "health")

                    });

                });

                $(".sports").click(function() {
                    console.log("sports button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {
                        console.log("api feed found...")

                        console.log(data.results)

                        switchNewsFeed(data, "sports")

                    });
                });

                $(".science").click(function() {
                    console.log("science button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {
                        console.log("api feed found...")

                        console.log(data.results)

                        switchNewsFeed(data, "science")

                    });
                });

                $(".technology").click(function() {
                    console.log("technology button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {
                        console.log("api feed found...")

                        console.log(data.results)

                        switchNewsFeed(data, "technology")

                    });
                });

                $(".keywords").click(function() {
                    console.log("keywords button clicked")

                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {
                        console.log("api feed found...")

                        console.log(data.results)

                        if ($('.newsfeed_table')) {
                            $('.newsfeed_table tr').remove();
                            console.log("children removed")
                        }

                        // Filter out the arrays with no elements
                        var newsfeed_data = data.results.filter(e => e.length);


                        categories = []
                        for (var preference = 0; preference < newsfeed_data.length; preference++) {
                            categories.push(newsfeed_data[preference][0].category)
                        }


                        console.log(categories)

                        // Create an array that has the default preferences 
                        preferences = ["business", "entertainment", "general", "health", "science", "sports", "technology"]

                        // Create an empty 
                        const preferencesSet = new Set(preferences);

                        // use filter() method
                        // to filter only those elements
                        // that need not to be deleted from the array
                        const keywords = categories.filter((category) => {
                            // return those elements not in the preferencesSet
                            return !preferencesSet.has(category);
                        });

                        console.log(keywords)


                        for (var preference = 0; preference < newsfeed_data.length; preference++) {
                            for (var article = 0; article < newsfeed_data[preference].length; article++) {
                                if (keywords.includes(newsfeed_data[preference][article].category)) {
                                    $(".newsfeed_table").append("<tr><td><img src = " + newsfeed_data[preference][article]['imageurl'] + " class = 'images_front' > </td></tr>" + "<tr class = 'title_row'>" + "<td><u><a href =" + newsfeed_data[preference][article]['url'] + ">" +
                                        newsfeed_data[preference][article]['title'] + "</a></u></tr>" + "<tr>" + "<td>" + newsfeed_data[preference][article]['category'] + "</tr>" +
                                        "<tr>" + "</td>" + "<td>" + newsfeed_data[preference][article]['dateandtime'] + "</td>" + "</tr>" + "<tr class = 'last_row'>" +
                                        "<td>From: " + newsfeed_data[preference][article]['author'] + "</td>" + "</tr>");
                                }
                            }
                        }
                    });
                });
            </script>
            <!--
            <script>
                $(document).ready(function() {

                            $(".business").click(showFeed('business')); //shows newsfeed of business preference when clicked

                            function showFeed(preference) {
                                console.log("business preference clicked")
                                $.getJSON("/newsfeed/{{session['user']}}", function(data) {

                                    console.log("api feed found...")
                                });
                            }
            </script>
            -->

        </div>

    </section>

    <section id="middle">


        <div class="newsfeed_list">
            <center>
                <table class="newsfeed_table">

                    <!--
                <tr> tr = table row
                    <th>Article Title</th> (th = table header)
                </tr>
                <tr>
                    <td>Date Published</td> (td = table dictionary)
                </tr>
                <tr>
                    <td>Category</td>
                </tr>
                -->
                </table>
            </center>

            <script>
                $(function() {
                    $.getJSON("/newsfeed/{{session['user']}}", function(data) {

                        console.log(data.results)
                        console.log(data.results[1].length)

                        for (var i = 0; i < 7; i++) {
                            if (data.results[i].length <= 0) {
                                console.log("User did not select this preference")
                            } else {
                                console.log(data.results[i])
                                for (var i2 = 0; i2 < data.results[i].length; i2++) {

                                    if ((i != null) && (i2 != null)) {

                                        console.log(data.results[i][i2]['category'])
                                        console.log(data.results[i][i2]['dateandtime'])

                                        $(".newsfeed_table").append("<tr><td><img src = " + data.results[i][i2]['imageurl'] + " class = 'images_front' > </td></tr>" + "<tr class = 'title_row'>" + "<td><u><a href =" + data.results[i][i2]['url'] + ">" + data.results[i][i2]['title'] +
                                            "</a></u></tr>" + "<tr>" + "<td>" + data.results[i][i2]['category'] + "</tr>" + "<tr>" + "</td>" +
                                            "<td>" + data.results[i][i2]['dateandtime'] + "</td>" + "</tr>" + "<tr class = 'last_row' >" +
                                            "<td>From: " + data.results[i][i2]['author'] + "</td>" + "</tr>");
                                    } else {

                                        var table = $(".newsfeed_table")
                                        table.append("<tr><td> ERROR: NEWSFEED DATA FOR CLIENT DID NOT LOAD INTO API </td></tr>")
                                        console.log("ERROR: NEWSFEED DATA FOR CLIENT DID NOT LOAD INTO API")

                                    }
                                }
                            }
                            //console.log(i)
                        }

                    });
                });

                // function fetchData(){
                //  fetch("/newsfeed/{{session['user']}}").then(response => {
                //console.log(response)
                //    return response.json();

                //}).then(data => {
                //  console.log(data.results)
                //})
                //.catch(error => { //checking for errors
                //  console.log(error)
                //});
                //}
                //var json_data = fetchData()
                //console.log(json_data)
            </script>
        </div>
    </section>

    <section id="bottom">
        <div class="footer">
            <hr size=3>
            <p>
                © 2021 SP Technologies
            </p>
        </div>
    </section>
</body>

</html>